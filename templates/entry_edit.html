{% extends "base.html" %}
{% block content %}
<section class="detail">
  <div class="detail-layout">
    <img class="detail-poster" loading="lazy"
         src="{{ e.poster_url or url_for('static', filename='icons/placeholder.png') }}"
         alt="Poster for {{ e.title }}">

    <div class="detail-meta">
      <h1>Edit: {{ e.title }}</h1>

      <form method="post">
        <!-- <label>Title</label> -->
        <!-- <input type="text" name="title" value="{{ e.title }}"> -->

        <label>Date watched</label>
        <input type="date" name="date_watched"
               value="{{ e.date_watched.isoformat() if e.date_watched }}">

        {# 5-star UI (saves 1–10 as before) #}
        <label>Rating</label>
        <input type="hidden" name="rating" id="ratingInput"
               value="{{ e.rating if e.rating is not none }}">
        {% set current_stars = (e.rating // 2) if e.rating is not none else 0 %}
        <div class="stars" data-max="5" aria-label="Set rating">
          {% for i in range(1,6) %}
            <button type="button" class="star{% if i <= current_stars %} active{% endif %}"
                    data-value="{{ i }}" aria-label="{{ i }}">★</button>
          {% endfor %}
        </div>

        <label>Review</label>
        <textarea name="review" rows="5">{{ e.review or '' }}</textarea>

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button type="submit">Save</button>
          <a class="button" href="{{ url_for('diary') }}">Cancel</a>
        </div>
      </form>

      <p class="muted small" style="margin-top:8px;">
        Need metadata?
        <a href="{{ url_for('item_detail', kind=e.kind, item_id=e.external_id|int if e.external_id.isdigit() else 0) }}">
          View details
        </a>
        (works when external id is TMDb numeric).
      </p>
    </div>
  </div>
</section>
{% endblock %}
